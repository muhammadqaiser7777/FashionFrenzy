<!-- Header -->
<header class="dashboard-header">
  <div class="header-content">
    <div class="logo-section">
      <img src="assets/images/main-logo.webp" alt="Fashion Frenzy" class="logo">
      <h1>Retailer Dashboard</h1>
    </div>
    <div class="user-section">
      <span class="user-name">{{ getUserName() }}</span>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </div>
</header>

<!-- Navigation Tabs -->
<nav class="dashboard-nav">
  <div class="nav-container">
    <button 
      class="nav-tab" 
      [class.active]="activeTab === 'overview'"
      (click)="setActiveTab('overview')">
      <i class="icon">ğŸ“Š</i>
      Overview
    </button>
    <button 
      class="nav-tab" 
      [class.active]="activeTab === 'products'"
      (click)="setActiveTab('products')">
      <i class="icon">ğŸ“¦</i>
      Products
    </button>
    <button 
      class="nav-tab" 
      [class.active]="activeTab === 'orders'"
      (click)="setActiveTab('orders')">
      <i class="icon">ğŸ“‹</i>
      Orders
    </button>

  </div>
</nav>

<!-- Main Content -->
<main class="dashboard-main">
  <div class="container" *ngIf="!isLoading; else loadingTemplate">
    
    <!-- Overview Tab -->
    <div *ngIf="activeTab === 'overview'" class="tab-content">
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon orders">ğŸ“‹</div>
          <div class="stat-content">
            <h3>{{ stats.total_orders }}</h3>
            <p>Total Orders</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon revenue">ğŸ’°</div>
          <div class="stat-content">
            <h3>{{ formatCurrency(stats.total_revenue) }}</h3>
            <p>Total Revenue</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon products">ğŸ“¦</div>
          <div class="stat-content">
            <h3>{{ stats.total_products }}</h3>
            <p>Products</p>
          </div>
        </div>
        
        <div class="stat-card" [class.warning]="stats.low_stock_products > 0">
          <div class="stat-icon stock">âš ï¸</div>
          <div class="stat-content">
            <h3>{{ stats.low_stock_products }}</h3>
            <p>Low Stock</p>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
          <button class="action-btn primary" (click)="navigateToProducts()">
            <i class="icon">â•</i>
            Add Product
          </button>
          <button class="action-btn secondary" (click)="navigateToOrders()">
            <i class="icon">ğŸ‘ï¸</i>
            View Orders
          </button>
          <button class="action-btn" (click)="refreshStats()">
            <i class="icon">ğŸ”„</i>
            Refresh Data
          </button>
        </div>
      </div>

      <!-- Recent Orders -->
      <div class="recent-orders">
        <h2>Recent Orders</h2>
        <div class="orders-list">
          <div class="order-item" *ngFor="let order of stats.recent_orders.slice(0, 5)">
            <div class="order-info">
              <span class="order-id">#{{ order.id }}</span>
              <span class="customer-email">{{ order.user_email }}</span>
              <span class="order-date">{{ formatDate(order.created_at) }}</span>
            </div>
            <div class="order-details">
              <span class="order-amount">{{ formatCurrency(order.total_amount) }}</span>
              <span class="order-status" [style.background-color]="getStatusColor(order.delivery_status)">
                {{ order.delivery_status }}
              </span>
              <span class="items-count">{{ order.items_count }} items</span>
            </div>
          </div>
          
          <div *ngIf="stats.recent_orders.length === 0" class="no-data">
            <p>No recent orders found</p>
          </div>
        </div>
        
        <button class="view-all-btn" (click)="navigateToOrders()">View All Orders</button>
      </div>

      <!-- Top Selling Products -->
      <div class="top-products">
        <h2>Top Selling Products</h2>
        <div class="products-grid">
          <div class="product-card" *ngFor="let product of stats.top_selling_products">
            <div class="product-image">
              <div class="placeholder-image">ğŸ“·</div>
            </div>
            <div class="product-info">
              <h4>{{ product.title }}</h4>
              <p class="category">{{ product.category }}</p>
              <div class="product-stats">
                <span class="sold">{{ product.quantity_sold }} sold</span>
                <span class="revenue">{{ formatCurrency(product.revenue) }}</span>
                <span class="stock" [class.low-stock]="product.stock < 10">
                  Stock: {{ product.stock }}
                </span>
              </div>
            </div>
          </div>
          
          <div *ngIf="stats.top_selling_products.length === 0" class="no-data">
            <p>No sales data available</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Products Tab -->
    <div *ngIf="activeTab === 'products'" class="tab-content">
      <div class="section-header">
        <h2>Product Management</h2>
        <div class="header-actions">
          <button class="btn-secondary" (click)="loadProducts()" [disabled]="isLoadingProducts">
            <i class="icon">ğŸ”„</i>
            {{ isLoadingProducts ? 'Loading...' : 'Refresh' }}
          </button>
          <button class="btn-primary" (click)="navigateToProducts()">
            <i class="icon">â•</i>
            Add New Product
          </button>
        </div>
      </div>
      
      <!-- Products Grid -->
      <div class="products-grid" *ngIf="!isLoadingProducts; else loadingProductsTemplate">
        <div class="product-card" *ngFor="let product of products">
          <div class="product-image">
            <img 
              *ngIf="product.images && product.images.length > 0" 
              [src]="getProductImageUrl(product)" 
              [alt]="product.title"
              class="product-img"
              (error)="handleImageError($event)">
            <div *ngIf="!product.images || product.images.length === 0" class="no-image">
              ğŸ“·
            </div>
            
            <div class="stock-badge" [style.background-color]="getStockColor(product.stock)">
              {{ getStockStatus(product.stock) }}
            </div>
          </div>
          
          <div class="product-info">
            <h3 class="product-title">{{ product.title }}</h3>
            <p class="product-category">{{ product.category }}</p>
            <p class="product-description">{{ product.description }}</p>
            
            <div class="product-pricing">
              <span class="current-price" *ngIf="product.discounted_price && product.discounted_price < product.price">
                {{ formatCurrency(product.discounted_price) }}
              </span>
              <span class="original-price" *ngIf="product.discounted_price && product.discounted_price < product.price">
                {{ formatCurrency(product.price) }}
              </span>
              <span class="current-price" *ngIf="!product.discounted_price || product.discounted_price >= product.price">
                {{ formatCurrency(product.price) }}
              </span>
            </div>
            
            <div class="product-stock">
              <span class="stock-info">Stock: {{ product.stock }} units</span>
            </div>
            
            <div class="product-actions">
              <button class="edit-btn" (click)="openEditProduct(product)">
                <i class="icon">âœï¸</i>
                Edit
              </button>
              <button class="delete-btn" (click)="deleteProduct(product)">
                <i class="icon">ğŸ—‘ï¸</i>
                Delete
              </button>
            </div>
          </div>
        </div>
        
        <div *ngIf="products.length === 0" class="no-products">
          <div class="no-products-content">
            <h3>No products found</h3>
            <p>Start by adding your first product to your store.</p>
            <button class="add-first-product-btn" (click)="navigateToProducts()">
              Add Your First Product
            </button>
          </div>
        </div>
      </div>

      <!-- Loading Products Template -->
      <ng-template #loadingProductsTemplate>
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>Loading products...</p>
        </div>
      </ng-template>
    </div>

    <!-- Orders Tab -->
    <div *ngIf="activeTab === 'orders'" class="tab-content">
      <div class="section-header">
        <h2>Order Management</h2>
        <button class="btn-secondary" (click)="navigateToOrders()">
          <i class="icon">ğŸ‘ï¸</i>
          View All Orders
        </button>
      </div>
      
      <div class="coming-soon">
        <div class="coming-soon-content">
          <h3>ğŸ“‹ Advanced Order Management</h3>
          <p>Complete order management interface is being built...</p>
          <ul>
            <li>âœ… View and filter orders by status</li>
            <li>âœ… Accept/Reject orders with reasons</li>
            <li>âœ… Order tracking and updates</li>
            <li>âœ… Customer communication</li>
            <li>ğŸ”„ Bulk order operations</li>
            <li>ğŸ”„ Order analytics and reporting</li>
          </ul>
          <button class="btn-secondary" (click)="navigateToOrders()">
            View Basic Orders Page
          </button>
        </div>
      </div>
    </div>



  </div>

  <!-- Loading Template -->
  <ng-template #loadingTemplate>
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading dashboard...</p>
    </div>
  </ng-template>
</main>
